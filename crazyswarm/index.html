<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Crazyswarm2 Setup in Highbay - DSTA Project Internal Wiki</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">DSTA Project Internal Wiki</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">DSTA Project Documentation</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Crazyswarm2 Setup in Highbay</a>
                            </li>
                            <li class="nav-item">
                                <a href="../execute/" class="nav-link">Execute Code on Highbay</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../execute/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#crazyswarm2-setup-in-highbay" class="nav-link">Crazyswarm2 Setup in Highbay</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#high-level-steps" class="nav-link">High-Level Steps</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#1-turn-on-vicon" class="nav-link">(1) Turn on VICON</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-connect-to-vicon-on-the-machine" class="nav-link">(2) Connect to VICON on the machine</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-position-and-turn-on-drones-and-plug-in-the-crazyradio" class="nav-link">(3) Position and turn on drones and plug in the Crazyradio</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#4-run-program-a-few-times-if-needed" class="nav-link">(4) Run program (a few times if needed)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#5-retrieve-drones-and-charge-if-needed" class="nav-link">(5) Retrieve drones and charge (if needed)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#debugging" class="nav-link">Debugging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="crazyswarm2-setup-in-highbay">Crazyswarm2 Setup in Highbay</h1>
<h2 id="high-level-steps">High-Level Steps</h2>
<ol>
<li>Turn on the VICON (just flip the switch and wait for it to turn on!)</li>
<li>Connect to VICON on the machine (run <code>ros2 launch mocap vicon.launch.xml</code>)</li>
<li>Position and turn on drones and plug in the Crazyradio</li>
<li><a href="https://delay-planner.github.io/internal-wiki/execute/">Run</a> program (a few times if needed)</li>
<li>Retrieve drones and charge (if needed)</li>
</ol>
<h2 id="1-turn-on-vicon">(1) Turn on VICON</h2>
<p>The best guide on how to turn on the VICON is <a href="https://gitlab.com/mit-acl/fsw/mocap/-/wikis/VICON:-Creating-Rigid-Bodies">here</a>. JUST FOLLOW STEPS 1-4 since we will be using the single-marker method. Make sure that the setup is live and looks a little like below:</p>
<p><img alt="Live" src="https://gitlab.com/mit-acl/fsw/mocap/-/wikis/assets/green_camera.png" /></p>
<h2 id="2-connect-to-vicon-on-the-machine">(2) Connect to VICON on the machine</h2>
<p>To allow Crazyswarm2 to access the information from VICON, run this in a terminal on the highbay machine:</p>
<pre><code>ros2 launch mocap vicon.launch.xml
</code></pre>
<p>It should successfully connect to the highbay machine and you should get latency readings. Make sure to keep this running in the background when running programs!</p>
<h2 id="3-position-and-turn-on-drones-and-plug-in-the-crazyradio">(3) Position and turn on drones and plug in the Crazyradio</h2>
<p>Plug in the Crazyradio into the desktop! Either Crazyradio works and any port works!</p>
<p>Check out <code>crazyswarm2/crazyflie/config/crazyflies.yaml</code>. The top of the file should look something like this:</p>
<pre><code>robots:
  cf1:
    enabled: true
    uri: radio://0/80/2M/E7E7E7E701
    initial_position: [0.0, 0.0, 0.0]
    type: cf21

  cf2:
    enabled: true
    uri: radio://0/80/2M/E7E7E7E702
    initial_position: [0.0, -1.0, 0.0]
    type: cf21

  cf3:
    enabled: true
    uri: radio://0/80/2M/E7E7E7E703
    initial_position: [0.0, 1.0, 0.0]
    type: cf21
</code></pre>
<p>To use less Crazyflies, change <code>enabled: false</code>. The axes of the highbay are like so:</p>
<pre><code>       -x
        |
        |
        |
-y ------------ +y
        |
        |
        |
       +x

              ----------------
              | Control Room |
              ----------------
</code></pre>
<p>The control room box is where the computers are located (in the far +x, +y side). The below assumes you're at the control room box facing the -x direction.</p>
<p>With the config file above, that means the crazyflies must be oriented like so:</p>
<pre><code>    -------                      -------                      -------
    | cf2 |   |-- 1.0 units --|  | cf1 |   |-- 1.0 units --|  | cf3 | 
    -------                      -------                      -------
</code></pre>
<p>You can tell which crazyflie is which based on the number written on tape on the bottom of it. For example, under cf1, there is a tape with the number 1 and it corresponds to URI <code>radio://0/80/2M/E7E7E7E701</code>.</p>
<p>The ends of the table is about 1.0 units (technically a little more but that's okay). Place the crazyflies on opposite ends of the table and make sure it is flat. Orient the crazyflies with the red and black battery wire facing the -x direction (away from the control room). Alternatively, you can think that you should align the front of the drone with the +x axis (facing towards the control room).</p>
<p><img alt="drone_front" src="https://www.bitcraze.io/images/documentation/overview/legend_top.png" /></p>
<p>Finally, turn on the drones. Firstly, make sure NO CRAZYFLIE PROGRAM IS CURRENTLY RUNNING. Then press the button power button for both drones (order and timing doesn't really matter). The power button is what's labelled the "reset button" below.</p>
<p><img alt="power button" src="https://docs.px4.io/main/assets/crazyflie_reset_button.teBoo3rl.jpg" /></p>
<p>The crazyflie will automatically test all its motors by gently spinning them. If this does not happen within a minute of turning on, try again (and make sure no program is currently sending it signals)!</p>
<p>Finally, close the velcro around the net so the crazyflies don't crash without the net!</p>
<h2 id="4-run-program-a-few-times-if-needed">(4) Run program (a few times if needed)</h2>
<p>Execute the program. Check out the info <a href="https://delay-planner.github.io/internal-wiki/execute/">here</a>!</p>
<p>You may need to execute it a few times before it successfully connects (if it doesn't do anything after about a minute, then it's almost certainly not connected so just rerun it!). If it fails a ton of times or keeps on getting stuck at some part, restart the crazyflie.</p>
<p>Here's a small compilation of errors I've run into and actions:</p>
<table>
<thead>
<tr>
<th>Error</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stuck on <code>Requesting memories...</code></td>
<td>Unplug and Replug the Crazyradio or Restart the Crazyflie</td>
</tr>
</tbody>
</table>
<h2 id="5-retrieve-drones-and-charge-if-needed">(5) Retrieve drones and charge (if needed)</h2>
<p>After the crazyflies do its thing, you'll need to retrieve them! I go under the net and try to grab the crazyflies out of one of the many holes in it. </p>
<p>To charge the crazyflie, connect it to a laptop using the USB-A to micro-USB cable. Make sure the battery is still plugged in. Turn on the crazyflie. It should have two blue lights with one of them flashing. While the light is flashing, it's being charged. If it's solid, it's done charging. REMEMBER: turn off the crazyflie before running code since it can still recieve signals while charging!!</p>
<h2 id="debugging">Debugging</h2>
<blockquote>
<p>My crazyflie automatically crashed out when trying to do anything (hello_world, etc.)</p>
</blockquote>
<p>The axes are probably incorrect. Recall:</p>
<pre><code>       -x
        |
        |
        |
-y ------------ +y
        |
        |
        |
       +x

              ----------------
              | Control Room |
              ----------------
</code></pre>
<p>Make the front of the drones facing +x. Also recall the position of the crazyflies (doesn't need to exactly 1.0 but roughly, about a table apart):</p>
<pre><code>    -------                      -------                      -------
    | cf2 |   |-- 1.0 units --|  | cf1 |   |-- 1.0 units --|  | cf3 | 
    -------                      -------                      -------
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
